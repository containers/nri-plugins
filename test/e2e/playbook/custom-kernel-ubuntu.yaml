---
- name: Install kernel build dependencies
  become: yes
  ansible.builtin.package:
    pkg:
      - git-core
      - build-essential
      - flex
      - bison
      - bc
      - kmod
      - cpio
      - libncurses5-dev
      - libelf-dev
      - libssl-dev
      - dwarves
    state: present
    update_cache: true

- name: Build kernel DEBs
  shell: "cd linux && make -j$(nproc) bindeb-pkg"

- name: Create vm:~/kernel-pkgs.tar containing kernel RPMs
  shell: "tar cf ~/kernel-pkgs.tar kernel-*.deb"
